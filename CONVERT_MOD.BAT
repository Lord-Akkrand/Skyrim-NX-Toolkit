@ECHO OFF

SET SCRIPTS_PATH=%~d0%~p0
SET CONVERT_MOD_PY="%SCRIPTS_PATH%convert_mod.py"
SET EMPTY=%SCRIPTS_PATH%Empty

SET ORIGINAL=%~f1
SET DUPLICATE=%~f1_Unpacked
SET DUPLICATE_DATA=%DUPLICATE%\Data

SET PATH=%PATH%;%SCRIPTS_PATH%
SET SDK_PATH=%SCRIPTS_PATH%

SET NVN_TEXTPKG="%SDK_PATH%NvnTools\NvnTexpkg.exe"

>CON ECHO Starting up...
IF EXIST %NVN_TEXTPKG% (
	SET HAS_SDK=true
) ELSE (
	SET HAS_SDK=false
)

>CON ECHO SDK Path is %SDK_PATH%
>CON ECHO HAS_SDK is set as %HAS_SDK%
>CON ECHO convert_mod.py is set at %CONVERT_MOD_PY%

>CON ECHO Akkrand's Mod Converter v1.0.3
PAUSE

>CON ECHO Finding Python 3.x path
>CON CALL FIND_PYTHON_PATH
IF ERRORLEVEL 1 GOTO pythonError

>CON ECHO Found Python 3.x path

>CON ECHO Making "%DUPLICATE%"
ROBOCOPY "%EMPTY%" "%DUPLICATE%" /MIR
ROBOCOPY "%ORIGINAL%" "%DUPLICATE_DATA%" /MIR

%PYTHON3% %CONVERT_MOD_PY% "%ORIGINAL%" "%DUPLICATE%" %HAS_SDK%
PAUSE

GOTO :EOF

:pythonError
>CON ECHO Error finding Python path